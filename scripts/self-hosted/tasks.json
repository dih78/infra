[
    {
        "id": 1,
        "type": 1,
        "payload": "{\"SwarmInitRequest\": {\"Spec\": {\"Annotations\": {\"Name\": \"default\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.swarm.id\": \"1\"}}}, \"ListenAddr\": \"0.0.0.0:2377\", \"AdvertiseAddr\": \"192.168.1.1\", \"ForceNewCluster\": false}}"
    },
    {
        "id": 2,
        "type": 7,
        "payload": "{\"NodeSpec\": {\"Name\": \"default\", \"Role\": \"manager\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.node.id\": \"1\", \"sh.infra.node.name\": \"default\"}, \"Availability\": \"active\"}}"
    },
    {
        "id": 3,
        "type": 0,
        "payload": "{\"NetworkName\": \"infra_net\", \"NetworkCreateOptions\": {\"Scope\": \"swarm\", \"Driver\": \"overlay\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.network.id\": \"1\"}, \"Attachable\": true}}"
    },
    {
        "id": 4,
        "type": 2,
        "payload": "{\"SwarmConfigSpec\": {\"Data\": \"IyBLZWVwIHRoaXMgZmlsZQ==\", \"Name\": \"svc_1_caddy_svc_dpl_1_cfg_infra_caddy_tls_keep\", \"Labels\": {\"sh.infra.kind\": \"config\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.content.hash\": \"ac953927ad31a333b3a326a74baf428f\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}}}"
    },
    {
        "id": 5,
        "type": 2,
        "payload": "{\"SwarmConfigSpec\": {\"Data\": \"IyBUaGlzIGlzIHRoZSBlbnRyeXBvaW50IGZvciBDYWRkeS4KIyBCeSBkZWZhdWx0LCBpdCBzdGFydHMgd2l0aCBhIGJsYW5rIENhZGR5ZmlsZSB3aXRoIGEgc3RhbmRhcmQgIkhlbGxvIGZyb20gQ2FkZHkiIHBhZ2UuCgppZiBbIC1mICIvY29uZmlnL2NhZGR5L2F1dG9zYXZlLmpzb24iIF07IHRoZW4KICAgIGVjaG8gIlN0YXJ0aW5nIHdpdGggYXV0b3NhdmUuanNvbiIKCiAgICBjYWRkeSBydW4gLS1jb25maWcgIi9jb25maWcvY2FkZHkvYXV0b3NhdmUuanNvbiIKZWxzZQogICAgZWNobyAiU3RhcnRpbmcgd2l0aCB0aGUgZGVmYXVsdCBDYWRkeWZpbGUiCgogICAgY2FkZHkgcnVuIC0tY29uZmlnICIvZXRjL2NhZGR5L0NhZGR5ZmlsZSIKZmk=\", \"Name\": \"svc_1_caddy_svc_dpl_1_cfg_start_sh\", \"Labels\": {\"sh.infra.kind\": \"config\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.content.hash\": \"7b19b2f4fc26c6e51ad2f6bc3a8b1670\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}}}"
    },
    {
        "id": 6,
        "type": 14,
        "payload": "{\"Image\": \"caddy:2.8-alpine\", \"PullOptions\": {}, \"AuthConfigName\": \"\"}"
    },
    {
        "id": 7,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {\"Command\": \"\", \"ConfigName\": \"\", \"ConfigLabels\": {}}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 1}}, \"Name\": \"svc_1_caddy_svc\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}, \"EndpointSpec\": {\"Ports\": [{\"Protocol\": \"tcp\", \"TargetPort\": 80, \"PublishMode\": \"ingress\", \"PublishedPort\": 80}, {\"Protocol\": \"tcp\", \"TargetPort\": 443, \"PublishMode\": \"ingress\", \"PublishedPort\": 443}, {\"Protocol\": \"tcp\", \"TargetPort\": 2019, \"PublishMode\": \"ingress\", \"PublishedPort\": 2019}]}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"svc.caddy.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"CADDY_ADMIN=0.0.0.0:2019\", \"PTAH_HOSTNAME=svc.caddy.infra.local\"], \"Args\": [\"/start.sh\"], \"Hosts\": [\"svc.caddy.infra.local\"], \"Image\": \"caddy:2.8-alpine\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}, \"Mounts\": [{\"Type\": \"volume\", \"Source\": \"svc_1_caddy_svc_data\", \"Target\": \"/data\", \"VolumeOptions\": {\"Labels\": {\"sh.infra.id\": \"volume-a1b2c3d4e5f\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}}}, {\"Type\": \"volume\", \"Source\": \"svc_1_caddy_svc_config\", \"Target\": \"/config\", \"VolumeOptions\": {\"Labels\": {\"sh.infra.id\": \"volume-g6h7i8j9k1\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}}}, {\"Type\": \"volume\", \"Source\": \"svc_1_caddy_svc_infra_backups\", \"Target\": \"/infra/backups\", \"VolumeOptions\": {\"Labels\": {\"sh.infra.id\": \"volume-l2m3n4o5p6\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"1\", \"sh.infra.service.slug\": \"caddy_happy_infra_1\", \"sh.infra.deployment.id\": \"1\"}}}], \"Command\": [\"sh\"], \"Configs\": [{\"File\": {\"GID\": \"0\", \"UID\": \"0\", \"Mode\": 511, \"Name\": \"/infra/caddy/tls/.keep\"}, \"ConfigName\": \"svc_1_caddy_svc_dpl_1_cfg_infra_caddy_tls_keep\"}, {\"File\": {\"GID\": \"0\", \"UID\": \"0\", \"Mode\": 511, \"Name\": \"/start.sh\"}, \"ConfigName\": \"svc_1_caddy_svc_dpl_1_cfg_start_sh\"}], \"Secrets\": [], \"Hostname\": \"dpl-1.svc.caddy.infra.local\", \"Placement\": {\"Constraints\": [\"node.labels.sh.infra.node.id==1\"]}, \"HealthCheck\": null}}}}"
    },
    {
        "id": 8,
        "type": 5,
        "payload": "{\"caddy\": {\"apps\": {\"http\": {\"servers\": {}}}}}"
    },
    {
        "id": 9,
        "type": 14,
        "payload": "{\"Image\": \"bitnami/postgresql:16\", \"PullOptions\": {}, \"AuthConfigName\": \"\"}"
    },
    {
        "id": 10,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {\"Command\": \"\", \"ConfigName\": \"\", \"ConfigLabels\": {}}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 1}}, \"Name\": \"svc_2_infra_pg\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"EndpointSpec\": {\"Ports\": []}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"pg.server.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"POSTGRESQL_USERNAME=infra_sh\", \"POSTGRESQL_PASSWORD=infra_sh\", \"POSTGRESQL_DATABASE=infra_sh\", \"PTAH_HOSTNAME=pg.server.infra.local\"], \"Args\": null, \"Hosts\": [\"pg.server.infra.local\"], \"Image\": \"bitnami/postgresql:16\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"Mounts\": [{\"Type\": \"volume\", \"Source\": \"svc_2_infra_pg_data\", \"Target\": \"/bitnami/postgresql\", \"VolumeOptions\": {\"Labels\": {\"sh.infra.id\": \"volume-q7r8s9t0a1\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}}}, {\"Type\": \"volume\", \"Source\": \"svc_2_infra_pg_infra_backups\", \"Target\": \"/infra/backups\", \"VolumeOptions\": {\"Labels\": {\"sh.infra.id\": \"volume-h7i8j9k0l1\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}}}], \"Command\": null, \"Configs\": [], \"Secrets\": [], \"Hostname\": \"dpl-2.pg.server.infra.local\", \"Placement\": {\"Constraints\": [\"node.labels.sh.infra.node.id==1\"]}, \"HealthCheck\": null}}}}"
    },
    {
        "id": 11,
        "type": 14,
        "payload": "{\"Image\": \"bitnami/pgbouncer\", \"PullOptions\": {}, \"AuthConfigName\": \"\"}"
    },
    {
        "id": 12,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {\"Command\": \"\", \"ConfigName\": \"\", \"ConfigLabels\": {}}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 1}}, \"Name\": \"svc_2_infra_pool\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"EndpointSpec\": {\"Ports\": []}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"pool.server.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"PGBOUNCER_POOL_MODE=session\", \"POSTGRESQL_USERNAME=infra_sh\", \"POSTGRESQL_PASSWORD=infra_sh\", \"POSTGRESQL_DATABASE=infra_sh\", \"POSTGRESQL_HOST=pg.server.infra.local\", \"PGBOUNCER_PORT=5432\", \"PGBOUNCER_DATABASE=infra_sh\", \"PTAH_HOSTNAME=pool.server.infra.local\"], \"Args\": null, \"Hosts\": [\"pool.server.infra.local\"], \"Image\": \"bitnami/pgbouncer\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"Mounts\": [], \"Command\": null, \"Configs\": [], \"Secrets\": [], \"Hostname\": \"dpl-2.pool.server.infra.local\", \"Placement\": [], \"HealthCheck\": null}}}}"
    },
    {
        "id": 13,
        "type": 14,
        "payload": "{\"Image\": \"ghcr.io/ptah-sh/ptah-server:latest\", \"PullOptions\": {}, \"AuthConfigName\": \"\"}"
    },
    {
        "id": 14,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {\"Command\": \"php artisan config:cache && php artisan migrate --no-interaction --verbose --ansi --force\", \"ConfigName\": \"svc_2_dpl_2_release_command\", \"ConfigLabels\": {\"sh.infra.kind\": \"release-command\", \"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 2}}, \"Name\": \"svc_2_infra_app\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"EndpointSpec\": {\"Ports\": []}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"app.server.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"APP_ENV=production\", \"APP_KEY=base64:APP_KEY\", \"BCRYPT_ROUNDS=12\", \"DB_CONNECTION=pgsql\", \"DB_HOST=pool.server.infra.local\", \"DB_DATABASE=infra_sh\", \"DB_USERNAME=infra_sh\", \"DB_PASSWORD=infra_sh\", \"LOG_CHANNEL=errorlog\", \"APP_URL=localhost\", \"BILLING_ENABLED=false\", \"PTAH_HOSTNAME=app.server.infra.local\"], \"Args\": null, \"Hosts\": [\"app.server.infra.local\"], \"Image\": \"ghcr.io/ptah-sh/ptah-server:latest\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"Mounts\": [], \"Command\": null, \"Configs\": [], \"Secrets\": [], \"Hostname\": \"dpl-2.app.server.infra.local\", \"Placement\": [], \"HealthCheck\": null}}}}"
    },
    {
        "id": 15,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 1}}, \"Name\": \"svc_2_infra_app_wkr_schedule\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"EndpointSpec\": {\"Ports\": []}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"schedule.app.server.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"APP_ENV=production\", \"APP_KEY=base64:APP_KEY\", \"BCRYPT_ROUNDS=12\", \"DB_CONNECTION=pgsql\", \"DB_HOST=pool.server.infra.local\", \"DB_DATABASE=infra_sh\", \"DB_USERNAME=infra_sh\", \"DB_PASSWORD=infra_sh\", \"LOG_CHANNEL=errorlog\", \"APP_URL=localhost\", \"BILLING_ENABLED=false\"], \"Args\": [\"php artisan config:cache && php artisan schedule:work\"], \"Hosts\": [\"schedule.app.server.infra.local\"], \"Image\": \"ghcr.io/ptah-sh/ptah-server:latest\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"Mounts\": [], \"Command\": [\"sh\", \"-c\"], \"Configs\": [], \"Secrets\": [], \"Hostname\": \"dpl-2.schedule.app.server.infra.local\", \"Placement\": [], \"HealthCheck\": {\"Test\": [\"NONE\"]}}}, \"UpdateConfig\": {\"Parallelism\": 1}}}"
    },
    {
        "id": 16,
        "type": 21,
        "payload": "{\"SecretVars\": {\"Values\": {}}, \"AuthConfigName\": \"\", \"ReleaseCommand\": {}, \"SwarmServiceSpec\": {\"Mode\": {\"Replicated\": {\"Replicas\": 1}}, \"Name\": \"svc_2_infra_app_wkr_queue\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"EndpointSpec\": {\"Ports\": []}, \"TaskTemplate\": {\"Networks\": [{\"Target\": \"infra_net\", \"Aliases\": [\"queue.app.server.infra.local\"]}], \"ContainerSpec\": {\"Env\": [\"APP_ENV=production\", \"APP_KEY=base64:APP_KEY\", \"BCRYPT_ROUNDS=12\", \"DB_CONNECTION=pgsql\", \"DB_HOST=pool.server.infra.local\", \"DB_DATABASE=infra_sh\", \"DB_USERNAME=infra_sh\", \"DB_PASSWORD=infra_sh\", \"LOG_CHANNEL=errorlog\", \"APP_URL=localhost\", \"BILLING_ENABLED=false\"], \"Args\": [\"php artisan config:cache && php artisan queue:work\"], \"Hosts\": [\"queue.app.server.infra.local\"], \"Image\": \"ghcr.io/ptah-sh/ptah-server:latest\", \"Labels\": {\"sh.infra.managed\": \"1\", \"sh.infra.service.id\": \"2\", \"sh.infra.service.slug\": \"infra_happy_infra_2\", \"sh.infra.deployment.id\": \"2\"}, \"Mounts\": [], \"Command\": [\"sh\", \"-c\"], \"Configs\": [], \"Secrets\": [], \"Hostname\": \"dpl-2.queue.app.server.infra.local\", \"Placement\": [], \"HealthCheck\": {\"Test\": [\"NONE\"]}}}, \"UpdateConfig\": {\"Parallelism\": 1}}}"
    },
    {
        "id": 17,
        "type": 5,
        "payload": "{\"caddy\": {\"apps\": {\"http\": {\"servers\": {\"listen_80\": {\"listen\": [\"0.0.0.0:80\"], \"routes\": [{\"match\": [{\"host\": [\"infra.localhost\"], \"path\": [\"/*\"]}], \"handle\": [{\"handler\": \"reverse_proxy\", \"headers\": {\"request\": {\"set\": {\"X-Forwarded-Host\": [\"infra.localhost\"], \"X-Forwarded-Port\": [\"80\"], \"X-Forwarded-Proto\": [\"http\"], \"X-Forwarded-Schema\": [\"http\"]}}, \"response\": {\"set\": {\"X-Powered-By\": [\"https://infra.sh\"], \"X-Ptah-Rule-Id\": [\"caddy-b2c3d4e5f6\"]}}}, \"transport\": {\"protocol\": \"http\"}, \"upstreams\": [{\"dial\": \"app.server.infra.local:8080\"}]}]}, {\"match\": [{\"host\": [\"*\"], \"path\": [\"/*\"]}], \"handle\": [{\"body\": \"<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>404 Not Found</title>\\n    <style>\\n        body {\\n            text-align: center;\\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\\n            height: 100vh;\\n            display: flex;\\n            flex-direction: column;\\n            align-items: center;\\n            justify-content: space-evenly;\\n        }\\n\\n        .home-btn {\\n            display: inline-block;\\n            background-color: #007bff;\\n            color: #fff;\\n            padding: 10px 20px;\\n            border-radius: 5px;\\n            text-decoration: none;\\n            margin-top: 20px;\\n        }\\n\\n        .home-btn:hover {\\n            background-color: #0069d9;\\n        }\\n\\n        .powered-by {\\n            margin-top: 20px;\\n            color: #999;\\n        }\\n    </style>\\n\\n    <script>\\n        window.addEventListener('DOMContentLoaded', () => {\\n            if (window.location.pathname === \\\"/\\\") {\\n                document.getElementById('goHome').remove();\\n            }\\n        })\\n    </script>\\n</head>\\n<body>\\n    <div>\\n        <h1>404 Not Found</h1>\\n        <p>The requested URL was not found on this server.</p>\\n\\n        <p>Please contact the server administrator if you believe this is an error.</p>\\n\\n        <a id=\\\"goHome\\\" class=\\\"home-btn\\\" href=\\\"/\\\">Return to the Home Page</a>\\n    </div>\\n\\n    <p class=\\\"powered-by\\\"><small>Powered by <a href=\\\"https://infra.sh\\\">infra.sh</a></small></p>\\n</body>\\n</html>\", \"handler\": \"static_response\", \"headers\": {\"Content-Type\": [\"text/html; charset=utf-8\"], \"X-Powered-By\": [\"https://infra.sh\"]}, \"status_code\": \"404\"}]}]}}}}}}"
    }
]
